<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Registro de Actividad - PCT</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Registro y seguimiento de actividades operacionales del sistema PCT.">
  <meta name="author" content="PCT">
  <link rel="canonical" href="https://pc-t.mx/actividad.html">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://pc-t.mx/actividad.html">
  <meta property="og:title" content="Registro de Actividad - PCT">
  <meta property="og:description" content="Registro y seguimiento de actividades operacionales del sistema PCT.">
  <meta property="og:site_name" content="PCT">
  <script>
    const CSS_VERSION = Date.now();
    document.write('<link rel="stylesheet" href="styles.css?v=' + CSS_VERSION + '">');
    console.log('[actividad] CSS cargado con versión:', CSS_VERSION);
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="img/logo.ico">
  <link rel="shortcut icon" href="img/logo.ico">
  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#ffffff">
  <style>
    [data-page="actividad"] input#q { min-width: 240px; padding: 0.5rem 0.6rem; border: 1px solid #e5e7eb; border-radius: 8px; }
    #doc-entry label { text-align: right; color: #374151; font-weight: 600; }
    #doc-entry input[type="text"],
    #doc-entry input[type="number"],
    #doc-entry select { height: 32px; padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 8px; }
  </style>
</head>
<body data-page="actividad">
  <header>
    <div class="logo"><img src="img/logopctch.png" alt="Logo" /></div>
    <button class="menu-toggle" aria-label="Abrir menú" aria-controls="primary-nav" aria-expanded="false">☰</button>
    <nav id="primary-nav">
      <ul>
        <li><a href="index.html">Dashboard</a></li>
        <li class="nav-dropdown"><details open><summary>Actividad</summary><ul>
          <li><a class="active" href="actividad.html">Registro de actividad</a></li>
          <li><a href="regactividad.html">Historial de registros</a></li>
        </ul></details></li>
        <li class="nav-dropdown"><details><summary>Pruebas</summary><ul>
          <li><a href="pruebas.html">Pruebas PND (pruebas no destructibles)</a></li>
          <li><a href="stockpruebas.html">PND x equipo</a></li>
          <li><a href="listapruebas.html">Registro PND</a></li>
        </ul></details></li>
        <li class="nav-dropdown"><details><summary>Inspección</summary><ul>
          <li><a href="inspeccion.html">Inspección primaria</a></li>
          <li><a href="reginspecciones.html">Registro de inspecciones</a></li>
        </ul></details></li>
        <li><a href="tareas.html">Tareas</a></li>
        <li><a href="reportes.html">Reportes</a></li>
      </ul>
    </nav>
    <div class="user-box">
      <span id="user-email"></span>
      <a id="login-link" href="login.html">Login</a>
      <button id="logout-btn" type="button" style="display:none">Salir</button>
    </div>
  </header>
  <main class="wide">
    <h1>Registro de Actividad</h1>

    <section id="activity-kpis" class="dashboard" style="margin: 12px 0 8px; display:none;">
      <div class="cards" id="activity-cards"></div>
    </section>

    <section id="summary" class="dashboard" style="margin-bottom: 10px; display:none;">
      <div class="cards" id="summary-cards"></div>
    </section>

    <div class="toolbar" role="region" aria-label="Herramientas de tabla">
      <div class="group">
        <input id="q" type="text" placeholder="Buscar..." aria-label="Buscar" />
        <button id="clearQ" class="btn-primary" type="button">Limpiar</button>
        <select id="clientFilter" aria-label="Agrupar por cliente" title="Agrupar/filtrar por cliente" style="height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">
          <option value="">Todos los clientes</option>
        </select>
        <button id="newRowBtn" class="btn-primary" type="button" onclick="openDocEditor && openDocEditor()">Nuevo registro</button>
        <button id="saveRowBtn" class="btn-primary" type="button" style="display:none;">Guardar</button>
        <button id="cancelRowBtn" type="button" style="display:none;">Cancelar</button>
      </div>
      <div class="toolbar-count" id="count">0 registros</div>
    </div>

    <!-- Formulario de captura modo documento (movido arriba de la tabla) -->
    <section id="doc-entry" aria-label="Nuevo registro (modo documento)" style="display:none; margin:14px 0; padding:14px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.03);">
      <h2 style="font-size:1rem; margin:0 0 8px;">Nuevo registro</h2>
      <div style="display:grid; grid-template-columns: 200px 1fr; gap:8px 12px; align-items:center;">
        <label>Tipo</label>
        <div>
          <select id="doc-tipo" name="tipo" style="height:34px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">
            <option value="propio">Propio</option>
            <option value="terceros">Terceros</option>
          </select>
          <input id="doc-proveedor" name="proveedor" type="text" placeholder="Proveedor" style="width:220px; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px; margin-left:8px; display:none;">
        </div>

        <label>Cliente</label>
        <input id="doc-cliente" type="text" placeholder="Cliente" style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>Equipo/Activo</label>
        <div>
          <input id="doc-equipo" type="text" placeholder="Equipo/Activo" style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;" list="dl-inventory-equipos">
          <span id="doc-equipo-counter" style="margin-left:8px; color:#6b7280; font-size:.9em;"></span>
          <div id="doc-multi-list" style="margin-top:8px; display:none; flex-direction:column; gap:4px;"></div>
          <div style="margin-top:6px; display:flex; gap:8px;">
            <input id="doc-equipo-add" type="text" placeholder="Agregar otro equipo/activo" style="flex:1; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">
            <button id="doc-equipo-clear" type="button" style="height:32px; padding:0 10px; border:1px solid #e5e7eb; background:#fff; border-radius:8px;">Vaciar lista</button>
          </div>
        </div>

        <label>Área del cliente</label>
        <input id="doc-area" type="text" placeholder="Área del cliente" style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>Ubicación</label>
        <input id="doc-ubic" type="text" placeholder="Ubicación" style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>Orden de Servicio</label>
        <input id="doc-os" type="text" placeholder="O. S." style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>Orden de Compra</label>
        <input id="doc-oc" type="text" placeholder="Orden de compra" style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>Factura</label>
        <input id="doc-factura" type="text" placeholder="Factura" style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>EST-COT</label>
        <input id="doc-estcot" type="text" placeholder="Cotización / Estimación" style="width:100%; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>Fecha Embarque</label>
        <input id="doc-embarque" type="text" placeholder="dd/mm/yy" class="date-input-masked" style="width:160px; height:32px;">

        <label>Inicio del servicio</label>
        <input id="doc-inicio" type="text" placeholder="dd/mm/yy" class="date-input-masked" style="width:160px; height:32px;">

        <label>Terminación del servicio</label>
        <input id="doc-term" type="text" placeholder="dd/mm/yy" class="date-input-masked" style="width:160px; height:32px;">

        <label>Días en servicio</label>
        <input id="doc-dias" type="number" min="0" placeholder="0" style="width:120px; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;">

        <label>Precio</label>
        <input id="doc-precio" type="number" min="0" step="0.01" placeholder="0.00" style="width:160px; height:32px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px; text-align:right;">

        <label>Serial (auto)</label>
        <div id="doc-serial" style="color:#6b7280; font-style:italic; white-space:pre-line; max-height:120px; overflow-y:auto;">—</div>

        <label>Descripción (auto)</label>
        <div id="doc-desc" style="color:#6b7280; font-style:italic; white-space:pre-line; max-height:120px; overflow-y:auto;">—</div>

        
      </div>
    </section>

    <div id="inventory-wrapper" class="table-responsive" aria-live="polite">
      <div class="scrollbar-x"><div class="scrollbar-content"></div></div>
      <div class="table-scroll">
        <table class="inventory" id="actTable" aria-describedby="count">
          <thead id="thead"></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

    <section id="activity-log" aria-label="Actividades registradas" style="margin-top:18px;">
      <h2 style="font-size:1rem; margin-bottom:8px;">Actividades registradas</h2>
      <ul id="activity-log-list" style="list-style:none; padding:0; margin:0; font-size:0.9rem; color:#334155;"></ul>
    </section>

  </main>
  <footer>
    <a href="https://unknownshoppers.com" target="_blank" rel="noopener noreferrer">Powered by <img src="img/logotus.jpg" alt="Unknown Shoppers" style="height:18px; vertical-align:middle"></a>
  </footer>

  <!-- Desregistrar service workers para evitar caché persistente en desarrollo -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="firebase-init.js"></script>
  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="actividad.js" defer></script>
 </body>
 </html>
  
</body>
</html>